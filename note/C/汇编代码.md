## int 3

1. int 3断点是一种很常用的断点类型，其机器码为0xCC，所以也称为CC指令；
2. int 3断点原理

 1）当执行一个int 3断点时，该地址处的内容被调试器用int3指令替换，但OD将int3隐藏，显示出来仍是下断前的指令；

 2）当被调试程序执行int3指令导致一个异常时，调试器就会捕捉这个异常从而停在断点处，然后将断点处的指令恢复成原来指令。

4. int 3断点的优缺点

 优点：可设置无数个断点；

 缺点：改变了原程序指令，容易被软件检测到。

5.int 3断点常用场合

 1）逆向：利用int 3断点来跟踪内存和寄存器的内容；

 2）防破解：

        一些软件为例阻碍被人破解，会在程序中使用int 3；从而使得利用int3的调试工具无法正常调试。
    
       一些防范API被下断的软件，会检测API的首地址是否为0xCC，来判断是否被下了断点。（躲过此类检查方法：将断点下在函数内部或末尾）

## I/O

outb()   I/O 上写入 8 位数据    ( 1 字节 )；

outw()   I/O 上写入 16 位数据  ( 2 字节 )；

outl ()   I/O 上写入 32 位数据   ( 4 字节)。



inb()   I/O 上读取 8 位数据    ( 1 字节 )；

inw()   I/O 上读取 16 位数据  ( 2 字节 )；

intl ()   I/O 上读取 32 位数据   ( 4 字节)。

## LEA

### Load Effective Address





## IRET

在“实地址模式”中，IRET 指令执行到中断程序或过程的远返回。在执行此操作的过程中，处理器从堆栈将返回指令指针、返回代码段选择器以及 EFLAGS 映像分别弹入 EIP、CS 以及 EFLAGS 寄存器，然后恢复执行中断的程序或过程。

在“保护模式”中，IRET 指令的操作取决于以下因素：EFLAGS 寄存器中 NT（嵌套任务）与 VM 标志的设置，以及当前堆栈中存储的 EFLAGS 映像中的 VM 标志的设置。根据这些标志的设置，处理器执行以下类型的中断返回：

从虚 8086 模式返回。

返回到虚 8086 模式

特权级别内返回。特权级别间返回。

从嵌套任务返回（任务切换）。

如果清除 NT 标志（EFLAGS 寄存器），则 IRET 指令执行从中断过程的远返回，而不执行任务切换。返回到的代码段的特权级别必须小于或等于中断处理例程的特权级别（如堆栈弹出的代码段选择器的 PRL 字段所示）。对于实地址模式中断返回，IRET 指令从堆栈将返回指令指针、返回代码段选择器以及 EFLAGS 映像分别弹入 EIP、CS 以及 EFLAGS 寄存器，然后恢复执行中断的程序或过程。如果返回到另一个特权级别，则在恢复程序执行之前，IRET 指令还从堆栈弹出堆栈指针与 SS。如果返回到虚 8086 模式，处理器还从堆栈弹出数据段寄存器。

如果设置 NT 标志，则 IRET 指令从嵌套任务（使用 CALL 指令、中断或异常调用的任务）执行任务切换（返回）到调用或中断的任务。执行 IRET 指令的任务的更新状态保存在它的 TSS 中。如果稍后重新进入该任务，则执行 IRET 指令后面的代码。
